<!DOCTYPE html>
<html>
<head>
  <title>Viewing Screen ‚Äì Zyra View</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    body {
      background: #fff;
      font-family: 'Segoe UI', sans-serif;
      padding-top: 60px;
      text-align: center;
    }
    video {
      width: 90%;
      border: 2px solid #00C897;
      border-radius: 10px;
      margin-top: 20px;
    }
    #status {
      color: #198754;
      font-weight: bold;
      margin-top: 15px;
    }
  </style>
</head>
<body>
  <h2 class="text-success">Zyra View ‚Äì Viewing Remote Screen</h2>
  <p class="lead">üîê Connecting to session...</p>
  <p id="status">Waiting for screen sharer to connect...</p>
  <video id="stream" autoplay></video>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();
    const roomId = window.location.pathname.split("/").pop();
    socket.emit("join-room", roomId);
    socket.emit("viewer-ready", roomId);

    const video = document.getElementById("stream");
    const mediaSource = new MediaSource();
    video.src = URL.createObjectURL(mediaSource);

    mediaSource.addEventListener("sourceopen", () => {
      const buffer = mediaSource.addSourceBuffer('video/webm; codecs="vp8"');
      socket.on("screen-stream", (data) => {
        const reader = new FileReader();
        reader.onload = () => buffer.appendBuffer(new Uint8Array(reader.result));
        reader.readAsArrayBuffer(data.chunk);
        document.getElementById("status").textContent = "‚úÖ Secure Session Active";
      });
    });
  </script>
</body>
</html>
