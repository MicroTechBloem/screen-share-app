<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Zyra View by Micro Tech Bloem</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="container">
    <h1>Zyra View</h1>
    <p>Get help or help someone by sharing or viewing screens securely with a code.</p>

    <button id="get-help-btn">Get Help (Share Your Screen)</button>
    <button id="help-someone-btn">Help Someone (View a Screen)</button>

    <div id="get-help-section" class="hidden">
      <h2>Your Security Code (changes every 10 minutes):</h2>
      <div id="code" class="code"></div>
      <div>Expires in <span id="countdown">--:--</span></div>
      <p>Share this code with someone you trust.</p>
      <button id="start-share">Start Sharing</button>
    </div>

    <div id="help-someone-section" class="hidden">
      <h2>Enter Security Code to View Screen</h2>
      <input type="text" id="input-code" placeholder="XXXX-XX" maxlength="7" />
      <button id="join-room-btn">Join</button>
      <p id="join-error" style="color: red; display:none;">Invalid code or room not found.</p>
    </div>
  </div>

  <script>
    const getHelpBtn = document.getElementById("get-help-btn");
    const helpSomeoneBtn = document.getElementById("help-someone-btn");
    const getHelpSection = document.getElementById("get-help-section");
    const helpSomeoneSection = document.getElementById("help-someone-section");
    const codeElem = document.getElementById("code");
    const countdownElem = document.getElementById("countdown");
    const startShareBtn = document.getElementById("start-share");
    const inputCode = document.getElementById("input-code");
    const joinRoomBtn = document.getElementById("join-room-btn");
    const joinError = document.getElementById("join-error");

    let currentCode = "";
    let countdownInterval;

    function generateCode() {
      const part1 = Math.floor(1000 + Math.random() * 9000); // 4 digits
      const part2 = Math.floor(10 + Math.random() * 90); // 2 digits
      return `${part1}-${part2}`;
    }

    function startCountdown(durationSec) {
      let timeLeft = durationSec;
      countdownElem.textContent = formatTime(timeLeft);
      countdownInterval = setInterval(() => {
        timeLeft--;
        if (timeLeft <= 0) {
          clearInterval(countdownInterval);
          newCode();
        } else {
          countdownElem.textContent = formatTime(timeLeft);
        }
      }, 1000);
    }

    function formatTime(sec) {
      const m = Math.floor(sec / 60);
      const s = sec % 60;
      return `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
    }

    function newCode() {
      currentCode = generateCode();
      codeElem.textContent = currentCode;
      startCountdown(600); // 10 minutes
    }

    getHelpBtn.onclick = () => {
      getHelpSection.classList.remove("hidden");
      helpSomeoneSection.classList.add("hidden");
      newCode();
    };

    helpSomeoneBtn.onclick = () => {
      helpSomeoneSection.classList.remove("hidden");
      getHelpSection.classList.add("hidden");
    };

    startShareBtn.onclick = () => {
      // Redirect to share.html with code param
      window.location.href = `share.html?room=${currentCode}`;
    };

    joinRoomBtn.onclick = () => {
      const code = inputCode.value.trim().toUpperCase();
      const valid = /^\d{4}-\d{2}$/.test(code);
      if (!valid) {
        joinError.style.display = "block";
        return;
      }
      joinError.style.display = "none";
      window.location.href = `view.html?room=${code}`;
    };
  </script>
</body>
</html>
