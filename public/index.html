<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Zyra View - Micro Tech Bloem</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="container">
    <h1>Zyra View</h1>
    <p>Get help or help someone by sharing your screen securely.</p>

    <button id="getHelpBtn">Get Help</button>
    <button id="helpSomeoneBtn">Help Someone</button>

    <div id="getHelpSection" class="hidden">
      <h2>Get Help</h2>
      <p>Your session code (changes every 10 minutes):</p>
      <div id="sessionCode" class="code"></div>
      <button id="startSharingBtn">Start Sharing</button>
      <div id="countdown"></div>
    </div>

    <div id="helpSomeoneSection" class="hidden">
      <h2>Help Someone</h2>
      <p>Enter the session code provided by the sharer:</p>
      <input type="text" id="codeInput" placeholder="XXXX-XX" maxlength="7" />
      <button id="joinViewBtn">Join</button>
    </div>
  </div>

  <script src="utils.js"></script>
  <script>
    const getHelpBtn = document.getElementById("getHelpBtn");
    const helpSomeoneBtn = document.getElementById("helpSomeoneBtn");
    const getHelpSection = document.getElementById("getHelpSection");
    const helpSomeoneSection = document.getElementById("helpSomeoneSection");
    const sessionCodeEl = document.getElementById("sessionCode");
    const countdownEl = document.getElementById("countdown");
    const startSharingBtn = document.getElementById("startSharingBtn");
    const codeInput = document.getElementById("codeInput");
    const joinViewBtn = document.getElementById("joinViewBtn");

    let sessionCode = "";
    let countdownInterval;

    function generateSessionCode() {
      // Format: 4 digits - 2 digits, e.g. 4812-30
      return Math.floor(1000 + Math.random() * 9000) + "-" + Math.floor(10 + Math.random() * 90);
    }

    function startCountdown(duration) {
      let timeLeft = duration;
      countdownEl.textContent = `Session expires in ${timeLeft} seconds`;

      countdownInterval = setInterval(() => {
        timeLeft--;
        if (timeLeft <= 0) {
          clearInterval(countdownInterval);
          countdownEl.textContent = "Session expired. Generate new code.";
          sessionCode = generateSessionCode();
          sessionCodeEl.textContent = sessionCode;
          startCountdown(duration);
        } else {
          countdownEl.textContent = `Session expires in ${timeLeft} seconds`;
        }
      }, 1000);
    }

    getHelpBtn.onclick = () => {
      getHelpSection.classList.remove("hidden");
      helpSomeoneSection.classList.add("hidden");
      sessionCode = generateSessionCode();
      sessionCodeEl.textContent = sessionCode;
      startCountdown(600); // 10 minutes
    };

    helpSomeoneBtn.onclick = () => {
      helpSomeoneSection.classList.remove("hidden");
      getHelpSection.classList.add("hidden");
    };

    startSharingBtn.onclick = () => {
      window.location.href = `share.html?code=${sessionCode}`;
    };

    joinViewBtn.onclick = () => {
      let code = codeInput.value.trim();
      if (/^\d{4}-\d{2}$/.test(code)) {
        window.location.href = `view.html?code=${code}`;
      } else {
        alert("Enter a valid code in format XXXX-XX");
      }
    };
  </script>
</body>
</html>
